syntax = "proto3";

package proto;

import "common.proto";

// Database service definition
service DBService {
    // query user info
    rpc UserQuery(DB.UserKey) returns (DB.UserQueryResult);

    // update user info
    rpc UserUpdateInfo(proto.common.UserBasicInfo)
        returns (proto.common.RspHeader);

    // register
    rpc UserRegister(proto.common.UserBasicInfo) returns (DB.UserLoginResult);

    // logout
    rpc UserLogout(DB.UserKey) returns (proto.common.RspHeader);
}

message DB {
    // user query key
    message UserKey {
        fixed64 usn   = 1;
        uint64  uid   = 2;
        string  email = 3;
    }
    // user extra information
    message UserExtraInfo {
        bytes secret = 1; // password hash
        bytes token  = 2; // access token
    }
    message UserQueryResult {
        proto.common.RspHeader     result = 1;
        proto.common.UserBasicInfo info   = 2;
    }
    message RegisterRequest {
        proto.common.RspHeader     result = 1;
        proto.common.UserBasicInfo info   = 2;
        UserExtraInfo              extra  = 3;
    }
    message UserLoginResult {
        proto.common.RspHeader     result = 1;
        proto.common.UserBasicInfo info   = 2;
        UserExtraInfo              extra  = 3;
    }
}
